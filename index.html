<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0f172a" />
  <title>–î–æ–º–∞—à–∫–∞ ‚Äî WebApp</title>

  <style>
    :root{
      --bg:#0b1220;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --line:rgba(255,255,255,.12);
      --accent:#60a5fa;
      --accent2:#22c55e;
      --danger:#ef4444;
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius:18px;
      --radius2:26px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue";
      background: radial-gradient(1200px 600px at 20% 0%, rgba(96,165,250,.20), transparent 60%),
                  radial-gradient(900px 500px at 90% 10%, rgba(34,197,94,.10), transparent 55%),
                  radial-gradient(900px 600px at 50% 110%, rgba(255,255,255,.06), transparent 60%),
                  var(--bg);
      color:var(--text);
      overflow-x:hidden;
    }

    /* ‚ùÑÔ∏è –ó–∏–º–Ω–∏–π —Ñ–æ–Ω: —Å–Ω–µ–∂–∏–Ω–∫–∏ (–Ω–µ –∞–Ω–∏–º–∞—Ü–∏—è, –ø—Ä–æ—Å—Ç–æ –≤–∞–π–±) */
    body::before{
      content:"";
      position:fixed;
      inset:-20px;
      pointer-events:none;
      opacity:.30;
      filter: blur(.15px);
      background-image:
        radial-gradient(circle at 12% 18%, rgba(255,255,255,.45) 0 1.5px, transparent 2px),
        radial-gradient(circle at 28% 72%, rgba(255,255,255,.35) 0 1.2px, transparent 1.8px),
        radial-gradient(circle at 70% 28%, rgba(255,255,255,.35) 0 1.4px, transparent 2px),
        radial-gradient(circle at 84% 62%, rgba(255,255,255,.30) 0 1.1px, transparent 1.8px),
        radial-gradient(circle at 48% 44%, rgba(255,255,255,.25) 0 1.2px, transparent 1.9px),
        radial-gradient(circle at 6% 86%, rgba(255,255,255,.22) 0 1.0px, transparent 1.6px),
        radial-gradient(circle at 94% 12%, rgba(255,255,255,.22) 0 1.0px, transparent 1.6px);
      background-size: 420px 420px;
      background-repeat: repeat;
      transform: translateZ(0);
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 18px 14px 28px;
      padding-top: max(18px, env(safe-area-inset-top));
      padding-bottom: max(28px, env(safe-area-inset-bottom));
      position:relative;
      z-index:1;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:14px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }

    .brand img{
      width:44px;height:44px;border-radius:14px;
      object-fit:cover;
      box-shadow: 0 10px 26px rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      flex:0 0 auto;
    }

    .brand .t{
      display:flex;flex-direction:column;min-width:0;
    }

    .brand .t b{
      font-size:14px;letter-spacing:.2px;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }

    .brand .t span{
      font-size:12px;color:var(--muted);
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }

    .actions{
      display:flex;align-items:center;gap:10px;flex:0 0 auto;
    }

    .iconbtn{
      width:44px;height:44px;border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      display:grid;place-items:center;
      box-shadow: 0 10px 26px rgba(0,0,0,.20);
      cursor:pointer;
      user-select:none;
    }
    .iconbtn:active{transform: translateY(1px)}
    .iconbtn svg{width:20px;height:20px;opacity:.9}

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.12);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .inner{padding:16px}

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media(min-width:820px){
      .grid{grid-template-columns: 1.05fr .95fr;}
    }

    .sectionTitle{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      margin: 0 0 10px;
    }
    .sectionTitle h2{
      margin:0;font-size:14px;letter-spacing:.2px;
    }
    .pill{
      font-size:12px;color:var(--muted);
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
    }

    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin: 10px 0 6px;
    }

    input, textarea{
      width:100%;
      padding: 12px 12px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline:none;
      font-size:14px;
    }
    textarea{min-height:110px;resize:vertical}

    .btnrow{
      display:flex;flex-wrap:wrap;gap:10px;margin-top:12px;
    }

    .btn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      padding: 12px 14px;
      border-radius: 18px;
      cursor:pointer;
      user-select:none;
      display:inline-flex;
      align-items:center;
      gap:10px;
    }
    .btn.primary{
      background: rgba(96,165,250,.20);
      border-color: rgba(96,165,250,.45);
    }
    .btn.good{
      background: rgba(34,197,94,.18);
      border-color: rgba(34,197,94,.42);
    }
    .btn.danger{
      background: rgba(239,68,68,.16);
      border-color: rgba(239,68,68,.42);
    }
    .btn:active{transform: translateY(1px)}

    .hint{
      margin-top:10px;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
    }

    .toast{
      position: fixed;
      left:50%;
      bottom: 22px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.75);
      border:1px solid rgba(255,255,255,.14);
      color:var(--text);
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 13px;
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 50;
    }
    .toast.show{opacity:1; transform: translateX(-50%) translateY(-2px);}

    /* =========================
       üõ† –¢–ï–•. –†–ê–ë–û–¢–´ (FULLSCREEN)
       ========================= */
    .maint{
      position: fixed;
      inset: 0;
      z-index: 9999;
      display:none;
      padding: max(16px, env(safe-area-inset-top)) 14px max(18px, env(safe-area-inset-bottom));
      background: rgba(6, 10, 20, .78);
      backdrop-filter: blur(10px);
    }
    .maint.on{display:flex; align-items:center; justify-content:center;}
    .maint .box{
      width: min(620px, 100%);
      border-radius: 26px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      box-shadow: 0 30px 90px rgba(0,0,0,.60);
      overflow:hidden;
    }
    .maint .head{
      padding: 14px 16px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .maint .head b{font-size:14px}
    .maint .body{padding:16px}
    .maint .row{
      display:flex;gap:12px;align-items:flex-start;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.10);
      border-radius: 18px;
      padding: 12px;
    }
    .maint .ico{
      width:34px;height:34px;border-radius:14px;
      display:grid;place-items:center;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.10);
      flex:0 0 auto;
    }
    .maint .row b{display:block;margin-bottom:4px}
    .maint .row p{margin:0;color:var(--muted);font-size:13px;line-height:1.35}
    .maint .note{
      padding: 0 16px 16px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
    }

    /* =========================
       ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ò (–õ–û–ì–û)
       ========================= */
    .panel{
      position: fixed;
      inset: 0;
      z-index: 200;
      display:none;
      background: rgba(6,10,20,.62);
      backdrop-filter: blur(10px);
      padding: max(16px, env(safe-area-inset-top)) 14px max(18px, env(safe-area-inset-bottom));
    }
    .panel.on{display:block}
    .panel .sheet{
      max-width: 760px;
      margin: 0 auto;
      border-radius: 26px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
      box-shadow: 0 30px 90px rgba(0,0,0,.60);
      overflow:hidden;
    }
    .panel .ph{
      padding: 14px 16px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .panel .ph b{font-size:14px}
    .logos{
      padding: 14px 16px 18px;
      display:flex;flex-wrap:wrap;gap:10px;
    }
    .logoItem{
      width: 54px;height:54px;border-radius:18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      display:grid;place-items:center;
      cursor:pointer; user-select:none;
      overflow:hidden;
      position:relative;
    }
    .logoItem img{width:100%;height:100%;object-fit:cover}
    .logoItem.active{
      outline: 2px solid rgba(96,165,250,.70);
      border-color: rgba(96,165,250,.55);
    }
    .logoItem.active::after{
      content:"‚úì";
      position:absolute;right:6px;top:6px;
      width:18px;height:18px;border-radius:999px;
      display:grid;place-items:center;
      font-size:12px;
      background: rgba(96,165,250,.85);
      color:#0b1220;
      border:1px solid rgba(255,255,255,.25);
    }
    .panel .pb{
      padding: 0 16px 16px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
    }
  </style>
</head>

<body>
  <!-- üõ† Fullscreen Maintenance (–∫—Ä–µ—Å—Ç–∏–∫ —É–±—Ä–∞–Ω, —á—Ç–æ–±—ã –Ω–µ –∞–±—É–∑–∏–ª–∏) -->
  <div id="maint" class="maint" aria-hidden="true">
    <div class="box" role="dialog" aria-modal="true">
      <div class="head">
        <b id="maintTitle">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã</b>
      </div>
      <div class="body">
        <div class="row">
          <div class="ico">üõ†</div>
          <div>
            <b id="maintHead">–°–µ—Ä–≤–∏—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è</b>
            <p id="maintMsg">–°–µ–π—á–∞—Å –º—ã –æ–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Ä–≤–∏—Å—ã. –î–æ–º–∞—à–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ —á—É—Ç—å –ø–æ–∑–∂–µ.</p>
          </div>
        </div>

        <div class="btnrow" style="margin-top:14px;">
          <button class="btn primary" id="btnRetry">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
          <button class="btn danger" id="btnExit">–í—ã–π—Ç–∏</button>
          <button class="btn" id="btnDev">–ù–∞–ø–∏—Å–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É</button>
        </div>

        <div class="note">
          –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —É—Ö–æ–¥–∏—Ç ‚Äî —Ç–µ—Ö—Ä–∞–±–æ—Ç—ã –µ—â—ë –∏–¥—É—Ç. –ü—Ä–æ—Å—Ç–æ –∑–∞–π–¥–∏ –ø–æ–∑–∂–µ.
        </div>
      </div>
    </div>
  </div>

  <!-- ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
  <div id="panel" class="panel" aria-hidden="true">
    <div class="sheet">
      <div class="ph">
        <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</b>
        <button class="iconbtn" id="panelClose" title="–ó–∞–∫—Ä—ã—Ç—å" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M18 6 6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>

      <div class="logos" id="logos"></div>
      <div class="pb">
        –í—ã–±–æ—Ä –ª–æ–≥–æ—Ç–∏–ø–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ (localStorage).
      </div>
    </div>
  </div>

  <div class="wrap" id="app">
    <div class="topbar">
      <div class="brand">
        <img id="brandLogo" src="./klasik.jpg" alt="logo">
        <div class="t">
          <b id="brandTitle">–ë–æ—Ç –¥–ª—è –î–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è</b>
          <span id="brandSub">DZ / –ö–Ω–∏–≥–∞ / –¢–µ—Ç—Ä–∞–¥—å / –®–∫–æ–ª–∞ / –°–æ–≤–∞</span>
        </div>
      </div>

      <div class="actions">
        <button class="iconbtn" id="btnSettings" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏" aria-label="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z" stroke="currentColor" stroke-width="2"/>
            <path d="M19.4 15a7.8 7.8 0 0 0 .1-2l2-1.2-2-3.5-2.3.7a7.7 7.7 0 0 0-1.7-1l-.3-2.4h-4l-.3 2.4a7.7 7.7 0 0 0-1.7 1l-2.3-.7-2 3.5 2 1.2a7.8 7.8 0 0 0 .1 2l-2 1.2 2 3.5 2.3-.7a7.7 7.7 0 0 0 1.7 1l.3 2.4h4l.3-2.4a7.7 7.7 0 0 0 1.7-1l2.3.7 2-3.5-2-1.2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="grid">
      <!-- –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –î–ó -->
      <div class="card">
        <div class="inner">
          <div class="sectionTitle">
            <h2>üìö –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –î–ó</h2>
            <span class="pill" id="statePill">online</span>
          </div>

          <label>–î–∞—Ç–∞</label>
          <input id="fDay" placeholder="01.01.2026" />

          <label>–ü—Ä–µ–¥–º–µ—Ç</label>
          <input id="fSubject" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –ê–ª–≥–µ–±—Ä–∞" />

          <label>–¢–µ–∫—Å—Ç –î–ó</label>
          <textarea id="fText" placeholder="–ù–∞–ø–∏—à–∏ –¥–æ–º–∞—à–∫—É –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º‚Ä¶"></textarea>

          <div class="btnrow">
            <button class="btn primary" id="btnSend">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            <button class="btn" id="btnCopy">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            <button class="btn danger" id="btnClear">–û—á–∏—Å—Ç–∏—Ç—å</button>
          </div>

          <div class="hint">
            –í Telegram WebApp –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ <b>sendData</b>. –í –±—Ä–∞—É–∑–µ—Ä–µ ‚Äî –º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –≤—Å—Ç–∞–≤–∏—Ç—å –≤ —á–∞—Ç –±–æ—Ç–∞.
          </div>

          <div class="btnrow" style="margin-top:10px;">
            <button class="btn good" id="btnOpenBot">–û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞</button>
          </div>
        </div>
      </div>

      <!-- –†–µ–ø–æ—Ä—Ç -->
      <div class="card">
        <div class="inner">
          <div class="sectionTitle">
            <h2>üêû –°–æ–æ–±—â–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ</h2>
            <span class="pill">–±—ã—Å—Ç—Ä–æ</span>
          </div>

          <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
          <input id="rTitle" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –î–ó" />

          <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
          <textarea id="rDetails" placeholder="–ß—Ç–æ –¥–µ–ª–∞–ª, —á—Ç–æ –æ–∂–∏–¥–∞–ª, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å‚Ä¶"></textarea>

          <div class="btnrow">
            <button class="btn primary" id="btnReport">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç</button>
            <button class="btn" id="btnDev2">–ù–∞–ø–∏—Å–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É</button>
          </div>

          <div class="hint">
            –ß–µ–º —Ç–æ—á–Ω–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ ‚Äî —Ç–µ–º –±—ã—Å—Ç—Ä–µ–µ —Ñ–∏–∫—Å.
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast">–ì–æ—Ç–æ–≤–æ</div>

  <script>
    /* =========================================================
       #–í–ö–õ/–í–´–ö–õ –¢–ï–•–†–ê–ë–û–¢ (–∏—â–∏ —ç—Ç–æ—Ç –±–ª–æ–∫)
       - null  => —Ä–µ–∂–∏–º –±–µ—Ä—ë–º —Å —Å–µ—Ä–≤–µ—Ä–∞ (/api/app_state)
       - true  => –≤—Å–µ–≥–¥–∞ —Ç–µ—Ö—Ä–∞–±–æ—Ç—ã (–¥–ª—è —Ç–µ—Å—Ç–∞)
       - false => –Ω–∏–∫–æ–≥–¥–∞ —Ç–µ—Ö—Ä–∞–±–æ—Ç—ã (–¥–ª—è —Ç–µ—Å—Ç–∞)
       ========================================================= */
    const FORCE_MAINTENANCE = null;

    // –ù–∏–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∏ –Ω–∏–∫ –±–æ—Ç–∞ (–ø–æ–º–µ–Ω—è–π –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    const DEV_USERNAME = "Temo4ka4";
    const BOT_USERNAME = "Temo4ka4";

    // –ï—Å–ª–∏ API –Ω–∞ –¥—Ä—É–≥–æ–º –¥–æ–º–µ–Ω–µ ‚Äî —É–∫–∞–∂–∏ —Ç—É—Ç, –∏–Ω–∞—á–µ –æ—Å—Ç–∞–≤—å –ø—É—Å—Ç–æ
    const API_BASE = "";

    // ‚úÖ –¢–û–õ–¨–ö–û –ù–û–í–´–ï –õ–û–ì–û (logo1..logo5)
    const LOGOS = [
      { id:"logo1", name:"–õ–æ–≥–æ 1", src:"./klasik.jpg" },
      { id:"logo2", name:"–õ–æ–≥–æ 2", src:"./logo2.jpg" },
      { id:"logo3", name:"–õ–æ–≥–æ 3", src:"./logo3.webp" },
      { id:"logo4", name:"–õ–æ–≥–æ 4", src:"./logo4.jpg" },
      { id:"logo5", name:"–õ–æ–≥–æ 5", src:"./logo5.webp" },
    ];

    const $ = (id)=>document.getElementById(id);
    const toast = $("toast");
    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      setTimeout(()=>toast.classList.remove("show"), 1400);
    }

    const tg = (window.Telegram && window.Telegram.WebApp) ? window.Telegram.WebApp : null;
    if (tg) { try{ tg.expand(); }catch(e){} try{ tg.ready(); }catch(e){} }

    function openDevChat(){
      const url = `https://t.me/${DEV_USERNAME}`;
      try{ if (tg && tg.openTelegramLink){ tg.openTelegramLink(url); return; } }catch(e){}
      window.open(url, "_blank");
    }
    function openBot(){
      const url = `https://t.me/${BOT_USERNAME}`;
      try{ if (tg && tg.openTelegramLink){ tg.openTelegramLink(url); return; } }catch(e){}
      window.open(url, "_blank");
    }

    function getLogoId(){ return localStorage.getItem("logo_id") || "logo1"; }
    function setLogoId(id){ localStorage.setItem("logo_id", id); applyLogo(); renderLogos(); }
    function applyLogo(){
      const id = getLogoId();
      const item = LOGOS.find(x=>x.id===id) || LOGOS[0];
      $("brandLogo").src = item.src;
    }
    function renderLogos(){
      const box = $("logos");
      box.innerHTML = "";
      const active = getLogoId();
      for (const it of LOGOS){
        const d = document.createElement("div");
        d.className = "logoItem" + (it.id===active ? " active" : "");
        const img = document.createElement("img");
        img.src = it.src;
        img.alt = it.name;
        d.appendChild(img);
        d.addEventListener("click", ()=>setLogoId(it.id));
        box.appendChild(d);
      }
    }

    function panelOpen(){
      $("panel").classList.add("on");
      $("panel").setAttribute("aria-hidden","false");
    }
    function panelClose(){
      $("panel").classList.remove("on");
      $("panel").setAttribute("aria-hidden","true");
    }
    $("btnSettings").addEventListener("click", panelOpen);
    $("panelClose").addEventListener("click", panelClose);
    $("panel").addEventListener("click", (e)=>{ if (e.target === $("panel")) panelClose(); });

    function setMaintenance(on, title, msg){
      const m = $("maint");
      if (on){
        $("maintTitle").textContent = title || "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã";
        $("maintHead").textContent = "–°–µ—Ä–≤–∏—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è";
        $("maintMsg").textContent = msg || "–°–µ–π—á–∞—Å –º—ã –æ–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Ä–≤–∏—Å—ã. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ —á—É—Ç—å –ø–æ–∑–∂–µ.";
        m.classList.add("on");
        m.setAttribute("aria-hidden","false");
        document.documentElement.style.overflow = "hidden";
        document.body.style.overflow = "hidden";
      } else {
        m.classList.remove("on");
        m.setAttribute("aria-hidden","true");
        document.documentElement.style.overflow = "";
        document.body.style.overflow = "";
      }
    }

    $("btnRetry").addEventListener("click", ()=>boot());
    $("btnExit").addEventListener("click", ()=>{
      try{ if (tg && tg.close) tg.close(); }catch(e){}
      window.close();
    });
    $("btnDev").addEventListener("click", openDevChat);
    $("btnDev2").addEventListener("click", openDevChat);
    $("btnOpenBot").addEventListener("click", openBot);

    function buildCopyText(){
      const day = $("fDay").value.trim();
      const subject = $("fSubject").value.trim();
      const text = $("fText").value.trim();
      return `üìö –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –î–ó\nüìÖ ${day || "‚Äî"}\nüìö ${subject || "–û–±—â–µ–µ"}\n\n${text || "‚Äî"}`;
    }
    $("btnCopy").addEventListener("click", async ()=>{
      try{ await navigator.clipboard.writeText(buildCopyText()); showToast("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ"); }
      catch(e){ showToast("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å"); }
    });
    $("btnClear").addEventListener("click", ()=>{
      $("fDay").value = ""; $("fSubject").value=""; $("fText").value="";
      showToast("–û—á–∏—â–µ–Ω–æ");
    });

    async function apiGet(path){
      const res = await fetch(API_BASE + path, { method:"GET" });
      if (!res.ok) throw new Error("HTTP " + res.status);
      return await res.json();
    }

    async function sendSuggest(){
      const day = $("fDay").value.trim();
      const subject = $("fSubject").value.trim();
      const text = $("fText").value.trim();
      if (!text){ showToast("–¢–µ–∫—Å—Ç –ø—É—Å—Ç–æ–π"); return; }

      // Telegram WebApp ‚Üí –≤ main.py
      if (tg && tg.sendData){
        tg.sendData(JSON.stringify({ action:"suggest_hw", date:day, subject, text }));
        showToast("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –±–æ—Ç–∞");
        return;
      }

      // –í –±—Ä–∞—É–∑–µ—Ä–µ ‚Äî –∫–æ–ø–∏—Ä—É–π –∏ –≤—Å—Ç–∞–≤–ª—è–π
      await navigator.clipboard.writeText(buildCopyText()).catch(()=>{});
      showToast("–û—Ç–∫—Ä–æ–π –≤ Telegram");
    }

    async function sendReport(){
      const title = $("rTitle").value.trim();
      const details = $("rDetails").value.trim();
      if (!title && !details){ showToast("–ü—É—Å—Ç–æ"); return; }

      if (tg && tg.sendData){
        tg.sendData(JSON.stringify({ action:"bug_report", title, details, page:"index" }));
        showToast("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –±–æ—Ç–∞");
        return;
      }
      showToast("–û—Ç–∫—Ä–æ–π –≤ Telegram");
    }

    $("btnSend").addEventListener("click", ()=>sendSuggest().catch(()=>showToast("–û—à–∏–±–∫–∞")));
    $("btnReport").addEventListener("click", ()=>sendReport().catch(()=>showToast("–û—à–∏–±–∫–∞")));

    async function boot(){
      applyLogo();
      renderLogos();
      $("statePill").textContent = tg ? "telegram" : "browser";

      try{
        if (FORCE_MAINTENANCE === true){
          setMaintenance(true, "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã", "–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á–µ–Ω–æ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ.");
          return;
        }
        if (FORCE_MAINTENANCE === false){
          setMaintenance(false);
          return;
        }

        const st = await apiGet("/api/app_state");
        if (st && st.maintenance){
          setMaintenance(true, st.title || "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã", st.message || "");
          return;
        }
        setMaintenance(false);
      }catch(e){
        // –µ—Å–ª–∏ API –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º
        setMaintenance(false);
      }
    }

    boot();
  </script>
</body>
</html>
