<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DEBUG WebApp</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:16px}
    pre{white-space:pre-wrap;background:#f4f4f6;padding:12px;border-radius:12px}
  </style>
</head>
<body>
  <h3>WebApp debug</h3>
  <pre id="out">loading...</pre>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
(async () => {
  const pre = document.createElement("pre");
  pre.style.whiteSpace = "pre-wrap";
  pre.style.padding = "12px";
  document.body.prepend(pre);

  const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;

  const info = {
    hasTelegramWebApp: !!tg,
    initDataLen: tg ? (tg.initData || "").length : 0,
    initDataUnsafeUser: tg?.initDataUnsafe?.user || null,
    platform: tg?.platform || null,
    version: tg?.version || null,
    href: location.href
  };

  // Проверка API /health
  let health = null;
  try {
    const r = await fetch("https://api.temo4ka4.ru/health", { method: "GET" });
    health = { ok: r.ok, status: r.status, text: await r.text() };
  } catch (e) {
    health = { error: String(e) };
  }

  pre.textContent = JSON.stringify({ info, health }, null, 2);

  // Если tg есть — скажем Telegram что мы готовы
  if (tg) { try { tg.ready(); tg.expand(); } catch(e){} }
})();
</script>

</body>
</html>
