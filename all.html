<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>WebApp debug</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:16px}
    pre{white-space:pre-wrap;background:#f4f4f6;padding:12px;border-radius:12px}
    button{padding:10px 12px;border-radius:10px;border:0;background:#eee;cursor:pointer;margin-right:8px}
  </style>
</head>
<body>
  <h3>WebApp debug</h3>
  <pre id="out">loading...</pre>
  <div style="margin-top:12px">
    <button id="btnReload">Обновить данные</button>
    <button id="btnExpand">tg.expand()</button>
  </div>

<script>
(async () => {
  const out = document.getElementById("out");
  const tg = window.Telegram?.WebApp || null;

  if (tg) {
    try { tg.ready(); tg.expand(); } catch(e) {}
  }

  async function load() {
    const info = {
      hasTelegramWebApp: !!tg,
      initDataLen: tg ? (tg.initData || "").length : 0,
      initDataUnsafeUser: tg?.initDataUnsafe?.user || null,
      platform: tg?.platform || null,
      version: tg?.version || null,
      href: location.href
    };

    let health;
    try {
      const r = await fetch("https://api.temo4ka4.ru/health", {
        method: "GET",
        headers: {
          // ВАЖНО: в реальных запросах к API ты будешь слать initData вот так:
          // "X-Telegram-InitData": tg?.initData || ""
        }
      });
      health = { ok: r.ok, status: r.status, text: await r.text() };
    } catch (e) {
      health = { error: String(e) };
    }

    out.textContent = JSON.stringify({ info, health }, null, 2);
  }

  document.getElementById("btnReload").onclick = load;
  document.getElementById("btnExpand").onclick = () => { try { tg?.expand(); } catch(e){} };

  await load();
})();
</script>
</body>
</html>
