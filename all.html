<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>WebApp debug</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:16px}
    pre{white-space:pre-wrap;background:#f4f4f6;padding:12px;border-radius:12px}
    .err{color:#b00020}
  </style>
</head>
<body>
  <h3>WebApp debug</h3>
  <pre id="out">loading...</pre>

<script>
(async () => {
  const out = document.getElementById("out");

  const tg = window.Telegram?.WebApp || null;
  if (tg) { try { tg.ready(); tg.expand(); } catch(e){} }

  const info = {
    hasTelegramWebApp: !!tg,
    initDataLen: tg ? (tg.initData || "").length : 0,
    platform: tg?.platform || null,
    version: tg?.version || null,
    href: location.href
  };

  async function testFetch(url, headers) {
    try {
      const r = await fetch(url, { method: "GET", headers: headers || {} });
      const text = await r.text();
      return { ok: r.ok, status: r.status, text };
    } catch (e) {
      return { error: String(e) };
    }
  }

  const health = await testFetch("https://api.temo4ka4.ru/health");

  // тест с initData (если есть)
  const initData = tg?.initData || "";
  const hw = initData
    ? await testFetch("https://api.temo4ka4.ru/api/homework_range?days_ahead=3", {
        "X-Telegram-InitData": initData
      })
    : { skipped: "initData empty" };

  out.textContent = JSON.stringify({ info, health, hw }, null, 2);
})();
</script>

</body>
</html>
